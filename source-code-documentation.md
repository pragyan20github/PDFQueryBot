## **Complete Source Code Documentation for PDFQueryBot**

### **Project Overview**

`PDFQueryBot` is a web-based application designed to interact with PDF files, allowing users to upload a PDF, query it, and receive responses based on the document's content. The system uses NLP (Natural Language Processing) techniques to process the uploaded PDF and generate human-like answers to user questions. It has a user-friendly interface built with **React.js** and a backend powered by **FastAPI**, which handles file uploads, queries, and the underlying machine learning models.

### **Key Components**

The project is divided into two main parts:

1. **Frontend** - Built with **React.js** to handle the user interface.
2. **Backend** - Built with **FastAPI** to handle server-side logic, including PDF uploads, text extraction, question answering, and database management.

#### **Frontend (React.js)**

The frontend is responsible for the user interface (UI), allowing users to upload PDFs, ask questions, and view the conversation history with the bot.

**Key components:**
- **App.js**: The main React component that manages the overall app functionality, such as file uploads, question handling, and displaying chat history.
- **State Management**: React `useState` hooks are used for managing the state of the application, including the uploaded files, the active PDF, the conversation, the user query, and error messages.
- **API Calls**: The frontend communicates with the backend using the `fetch()` API to make requests to endpoints like `/upload`, `/ask`, and `/get_chats`.
- **UI Components**:
  - **File Upload Section**: Users can upload PDFs.
  - **Conversation Section**: Displays a chat-like interface for interacting with the bot.
  - **Sidebar**: Displays the list of uploaded PDFs and allows users to select one to view its chat history.
  - **New Chat Button**: Resets the conversation and starts a new session.

**Frontend Workflow**:
- The user selects and uploads a PDF file.
- After the upload, the user can ask questions related to the content of the PDF.
- The app queries the backend, retrieves the answer, and displays it in a chat format.
- The sidebar lists uploaded PDFs and allows users to navigate between different chat histories.

#### **Backend (FastAPI)**

The backend is responsible for handling all server-side logic, including:
- File uploads
- Text extraction from PDFs
- Text processing and NLP-based question answering
- Database management for storing and retrieving chat history

**Key components**:
- **FastAPI App**: The main backend framework that handles HTTP requests and routes.
- **API Endpoints**:
  - `/upload`: Receives the uploaded PDF file and saves it to the server.
  - `/ask`: Processes the user query, extracts text from the selected PDF, and uses NLP models to generate an answer.
  - `/get_chats/{pdf_filename}`: Retrieves the chat history for a particular PDF file.
  - `/get_pdf_text/{pdf_filename}`: Extracts and returns the text content of the uploaded PDF.
  
- **PDF Text Extraction**: Uses the **PyMuPDF (fitz)** library to extract raw text from uploaded PDF files.
  
- **NLP Models**:
  - **Sentence-Transformer**: Used to create embeddings for the PDF text chunks and user queries. These embeddings help in measuring semantic similarity between the question and document sections.
  - **T5 Model**: A pre-trained transformer model used for generating answers based on the user's question and relevant context from the PDF.
  
- **Database (SQLite)**: Stores chat history between the user and the bot for each uploaded PDF. Each entry includes the question asked and the corresponding answer generated by the bot.

- **Text Splitter**: Uses **Langchain's RecursiveCharacterTextSplitter** to split large texts from PDFs into smaller chunks. This helps with efficiently handling long documents and improving the relevance of the answers.

**Backend Workflow**:
1. The user uploads a PDF, which is saved to the server in the `./uploads` directory.
2. When the user asks a question, the system extracts the text from the PDF and splits it into chunks.
3. The question is embedded using the **SentenceTransformer** model, and then it is compared with the PDF chunks to find the most relevant text.
4. The **T5 model** is used to generate an answer based on the most relevant chunk of text.
5. The chat (question and answer) is stored in the database for later retrieval.

#### **Database (SQLite)**

SQLite is used for storing the chat history of each uploaded PDF. Each record contains:
- `pdf_filename`: The name of the uploaded PDF.
- `question`: The user’s question.
- `answer`: The generated answer based on the document’s content.

The `ChatHistory` model is used to interact with the database.

---

### **File Descriptions**

#### **1. `main.py` (Backend - FastAPI)**

This file contains the FastAPI app with the following functionality:
- **PDF upload**: Handles the `/upload` endpoint where users can upload a PDF.
- **Text extraction**: Extracts text from uploaded PDFs using **PyMuPDF**.
- **Question answering**: Uses **SentenceTransformer** for embedding generation and **T5** model for generating answers based on the extracted text.
- **Database**: Defines the `ChatHistory` SQLAlchemy model to store and retrieve chat history.

Key functions in `main.py`:
- `upload_pdf()`: Receives and saves the PDF file to the server.
- `ask_question()`: Handles user queries by extracting text, finding relevant chunks, generating answers, and saving the chat history.
- `get_chats()`: Retrieves chat history for a given PDF.
- `get_pdf_text()`: Prints and returns the raw text of a PDF.

#### **2. `App.js` (Frontend - React.js)**

This is the main React component that manages the UI and interactions with the backend:
- **State Management**: Uses `useState` hooks to handle file uploads, questions, conversation history, and error states.
- **API Calls**: Communicates with the backend endpoints (`/upload`, `/ask`, `/get_chats`) using `fetch()`.
- **UI Layout**:
  - File upload functionality.
  - A dynamic chat interface that displays messages from the user and bot.
  - Sidebar for selecting and viewing the chat history of uploaded PDFs.

#### **3. `styles.css` (Frontend - Styling)**

This file contains the styling for the frontend, defining the layout and visual appearance of the app:
- **General Layout**: Includes styles for the taskbar, sidebar, chat sections, and buttons.
- **Chat Bubbles**: Differentiates between user and bot messages by coloring the message bubbles and aligning them on different sides of the screen.
- **File Upload**: Provides styling for the file upload section and buttons.

---

### **Architecture and Flow**

1. **Frontend**: 
   - The React app allows users to upload PDFs and interact with the bot. It makes API calls to the backend to upload files, ask questions, and retrieve chat history.

2. **Backend**:
   - The FastAPI backend handles the file uploads, text extraction from PDFs, and the NLP-based question-answering functionality. It also manages the database where chat history is stored.

3. **NLP and Embeddings**:
   - When a user asks a question, the question is processed by the **SentenceTransformer** model to create an embedding. This embedding is compared with the embeddings of text chunks extracted from the PDF to find the most relevant part of the document.
   - The **T5** model is then used to generate a response to the question based on the selected text.

4. **Database**:
   - All questions and answers are stored in an SQLite database to maintain chat history, allowing users to view past conversations for each uploaded PDF.

---

### **Deployment Instructions**

1. **Install Dependencies**:
   - Backend:
     ```
     pip install fastapi uvicorn sqlalchemy PyMuPDF sentence-transformers transformers langchain
     ```
   - Frontend:
     ```
     npm install
     ```

2. **Start the Backend**:
   ```
   uvicorn main:app --reload
   ```

3. **Start the Frontend**:
   ```
   npm start
   ```

4. **Access the Application**:
   - The frontend will be available at `http://localhost:3000`.
   - The backend will be available at `http://localhost:8000`.
